---
import { Moon, Sun } from "@lucide/astro";
---

<button
  id="theme-toggle"
  class="px-4 py-2 rounded-full text-sm h-8 w-fit flex items-center justify-center cursor-pointer border-2 transition-all duration-300"
  aria-label="Toggle theme"
>
  <span id="theme-icon">
    <Sun class="dark:hidden" />
    <Moon class="hidden dark:block" />
  </span>
</button>

<script>
  const themeToggle = document.getElementById("theme-toggle");
  const themeIcon = document.getElementById("theme-icon");

  if (!themeToggle || !themeIcon) {
    throw new Error("Theme toggle elements not found");
  }

  // Function to update button styles based on theme
  const updateButtonStyles = (isDark: boolean) => {
    // Remove all theme-related classes
    themeToggle.classList.remove(
      "bg-white",
      "bg-green-500",
      "border-green-500",
      "border-black",
      "text-white",
      "text-black",
      "hover:bg-green-600",
      "hover:bg-green-400"
    );

    if (isDark) {
      // Dark mode: black border, green background
      themeToggle.classList.add(
        "bg-green-500",
        "border-black",
        "text-white",
        "hover:bg-green-400"
      );
    } else {
      // Light mode: green border, white background
      themeToggle.classList.add(
        "bg-white",
        "border-green-500",
        "text-black",
        "hover:bg-green-600"
      );
    }
  };

  // Initialize theme from localStorage or default to light mode
  let isDarkMode = localStorage.getItem("theme") === "dark";

  // Apply initial theme
  if (isDarkMode) {
    document.documentElement.classList.add("dark");
  } else {
    document.documentElement.classList.remove("dark");
  }
  updateButtonStyles(isDarkMode);

  // Toggle theme on button click
  themeToggle.addEventListener("click", () => {
    isDarkMode = !isDarkMode;

    if (isDarkMode) {
      document.documentElement.classList.add("dark");
      localStorage.setItem("theme", "dark");
    } else {
      document.documentElement.classList.remove("dark");
      localStorage.setItem("theme", "light");
    }
    updateButtonStyles(isDarkMode);
  });
</script>
